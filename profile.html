<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>ITAhM</title>
		
		<style>
@import "css/itahm.css";

body {
	padding: 20px;
}

body {
	padding: 20px;
}

header {
	text-align: right;
}

#list {
	list-style: none;
	padding: 3px;
	margin: 0;
}

#list span {
	display: inline-block;
	padding: .5em .5em .5em 1.5em;
	background: url(img/list.png) no-repeat left center;
	background-size: 1em;
}

#list span:hover {
	text-decoration: underline;
	cursor: pointer;
}

		</style>
		
	</head>
	
	<body class="loading content_width">
		
		<header>
			<button id="sync" class="r_button">Sync</button>
		</header>
		
		<ul id="list"></ul>
		
		<div class="bg_loading"></div>
		
		<script>
if (top === window) {
	location.href = "http://itahm.com";
}

(function (window, undefined) {
	
	var list = document.getElementById("list");
	
	document.getElementById("sync").onclick = onSync;
	
	initialize();
	
	function onSync() {
		if (!confirm("Synchronize profile database with agent now?")) {
			return;
		}
		
		top.sendRequest({
			command: "push",
			database: "profile",
			sequence: top.databases.profile.sequence,
			data: top.databases.profile.data
		}, function (response) {
			if (response) {
				top.databases.profile.sequence = response.sequence;
			}
			else {
				alert("synchronization failed.");
			}
		});
	}
	
	function onSelectProfile(name) {
		top.showDialog("profile_dialog.html",
			function (dialog) {
				dialog.initialize(name);
			},
			function () {
				location.reload();
			});
	}
	
	function initialize() {
		var profileData = top.databases.profile.data,
			df = document.createDocumentFragment(),
			span;
		
		for (var name in profileData) {
			span = document.createElement("span");
			span.textContent = name;
			span.onclick = onSelectProfile.bind(undefined, name);
			
			df.appendChild(document.createElement("li"))
				.appendChild(span);
		}
		
		list.appendChild(df);
		
		setTimeout(function () {
			document.body.classList.remove("loading");
		}, 500);
	};
	
}) (window);

		</script>
	
	</body>
	
</html>