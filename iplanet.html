<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Cache-Control" content="no-cache">
		
		<title>Main @ ITAhM</title>
		
		<style>
@import "css/itahm.css";

body {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	padding: 0; margin: 0;
	display: flex;
	flex-direction: column;
}

header {
	background-color: #4d525a;
	color: #fff;
	overflow: hidden;
	display: flex;
	justify-content: center;
}

body.auto >header {
	transition: height .5s;
	position: fixed; top: 0; right: 0; left: 0; height: 80px;
	z-index: 1;
}

body.auto >header::before {
	content: "";
	position: absolute; right: 0; left: 0; bottom: 0;
	height: 3px;
	background-color: #ccc;
}

body.auto >header:not(:hover) {
	height: 0;
}

body.auto >.handle:hover +header {
	height: 80px;
}

header a,
header a:visited,
header a:link,
header a:active,
header a:hover {
	color: inherit;
	text-decoration: none;
	cursor: pointer;
	display: inline-block;
	height: 100%;
}

nav {
	position: relative;
	display: flex;
	align-items: center;
	justify-content: space-between;
}

nav >i {
	position: absolute; top: 0; right: 0; bottom: 0; left: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 2em;
	color: rgba(200, 200, 200, 0.5);
	z-index: -1;
}

nav >i:not(:empty)::before {
	content: "라이선스가";
}

nav >i:not(:empty)::after {
	content: " 에 만료됩니다.";
}

nav >ul {
	list-style: none;
	padding: 0;
	display: flex;
}

nav >ul:first-of-type a {
	text-shadow: 1px 1px 1px #000;
	padding: 0.2em 1em;
	border-radius: 1em;
	position: relative;
}

nav >ul:first-of-type a:hover {
	color: #4d525a;
	text-shadow: none;
	background-color: #fff;
}

nav ul:first-of-type a:hover::after {
	content: "";
	position: absolute;
	top: 100%; left: 50%;
	transform: translateX(-50%);
	border: 10px solid transparent;
	border-top-color: #fff;
}

nav ul:last-of-type {
	color: #999;
}

nav ul:last-of-type a:hover {
	color: #fff;
}

nav h1 {
	color: #fff;
	font-size: 16px;
}

nav ul:last-of-type li {
	margin: 5px;
}

section {
	flex: 1;
	display: flex;
}

#frame {
	flex: 1;
	width: 100%; height: 100%;
	border: none;
	background-color: #4d525a;
}

#dialog {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	padding: 0;
	margin: 0;
	width: 100%;
	height: 100%;
}

div.log {
	position: fixed; right: 10px; top: 10px;
	cursor: pointer;
}

div.log span {
	display: inline-block;
	font-weight: bold;
	background-color: #ffa500;
	color: #fff;
}

#signout:before {
	content: attr(title);
}

#signout:hover:before {
	content: "로그아웃";
}

#count {
	width: 2em; height: 2em;
	box-sizing: border-box;
	padding: .5em;
	border-radius: 1em;
	text-align: center;
}

#log {
	padding: .5em .5em .5em 1em;
	margin-left: 1em;
	border-radius: 1em 0 0 1em;
}

.handle {
	position: fixed; top: -1em; left: 50%;
	border: 1em solid red;
	border-radius: 50%;
	transform: translateX(-50%);
}

.handle:hover+ header {
	height: 60px;
}

body:not(.log) .log,
body:not(.dialog) #dialog,
body:not(.auto) >.handle {
	display: none;
}

		</style>
	<script src="js/google.js"></script>
	<script>

function showChart(ip, resource, index) {
	var chart = window.chart[ip];

	if (chart && !chart.closed) {
		chart.close();
	}
	
	window.chart[ip] = chart = window.open("status.html?"+ ip);
	
	if (resource) {
		chart.onload = function () {
			chart.onSelectResource && chart.onSelectResource(resource, index);
		};
	}
	
	chart.focus();
}

// public
function setMenu(b) {
	if ("expire" in window.databases.config && databases.config.expire > 0) {
		document.body.classList.remove("auto");
	}
	else {
		document.body.classList[b? "remove": "add"]("auto");
	}
} 

function getDeviceName(ip) {
	var device = window.databases.device[ip];

	return device? device.name: ip;
}

function showDialog() {
	var opener = this,
		url = Array.prototype.shift.call(arguments),
		args = arguments;
	
	window.dialog.onload = function () {
		this.contentWindow.initialize.apply(opener, args);
		
		document.body.classList.add("dialog");
	};
	
	window.dialog.src = url;
}

function closeDialog() {
	document.body.classList.remove("dialog");
}

function toDateString(m) {
	const d = new Date(m),
		a = [d.getFullYear()];
	let n = d.getMonth();
	
	a[a.length] = "년 ";
	a[a.length] = n > 9? n: ("0"+ n);
	a[a.length] = "월 ";
	
	n = d.getDate();
	
	a[a.length] = n > 9? n: ("0"+ n);
	a[a.length] = "일";
	
	return a.join("");
}

function initialize() {
	// TODO ITAhM의 시작.
	document.title = "127.0.0.1 @ ITAhM";
	
	setMenu(false);
	
	document.querySelector("iframe").src = "ipboard.html";
}

	</script>
	</head>
	
	<body class="auto">
		
		<div class="handle"></div>
		
		<header>
			<nav class="content_width">
				<i id="expire"></i>
				<ul>
					<li><h1><a href="ipboard.html" target="main">대쉬보드</a></h1>
				</ul>
			</nav>
		</header>
		
		<section>
			<iframe id="frame" name="main"></iframe>
		</section>
		
		<div class="log">
			<a href="event.html" target="main">
				<span id="count">99</span>
				<span id="log">message</span>
			</a>
		</div>
		
		<iframe id="dialog"></iframe>
		
		<script src="js/ITAhM.js"></script>
		<script src="js/object.js"></script>
		<script src="js/icon.js"></script>
		<script>

var
	databases = {
		local: {
			scale: 1,
			icon: ITAhM.iconData
		},
		device: {
			"192.168.0.1":{
				"ip":"192.168.0.1",
				"name":"백본",
				"label":"센터",
				"type":"layer3 switch"
			},
			"192.168.100.1":{
				"ip":"192.168.0.1",
				"name":"TrusGuard",
				"label":"센터",
				"type":"firewall"
			},
			"192.168.0.11":{
				"ip":"192.168.0.11",
				"name":"NVR",
				"label":"센터",
				"type":"video recorder"
			},
			"192.168.0.12":{
				"ip":"192.168.0.12",
				"name":"미디어 DB",
				"label":"센터",
				"type":"database"
			},
			"192.168.0.13":{
				"ip":"192.168.0.13",
				"name":"SQL",
				"label":"센터",
				"type":"database"
			},
			"192.168.0.14":{
				"ip":"192.168.0.14",
				"name":"모바일 서버",
				"label":"센터",
				"type":"server"
			},
			"192.168.0.15":{
				"ip":"192.168.0.15",
				"name":"관리 서버",
				"label":"센터",
				"type":"server"
			},
			"192.168.0.16":{
				"ip":"192.168.0.16",
				"name":"이벤트 서버",
				"label":"센터",
				"type":"server"
			},
			"192.168.0.17":{
				"ip":"192.168.0.17",
				"name":"로그 서버",
				"label":"센터",
				"type":"server"
			},
			"192.168.0.18":{
				"ip":"192.168.0.18",
				"name":"NMS",
				"label":"센터",
				"type":"nms"
			},
			"192.168.0.100":{
				"ip":"192.168.0.100",
				"name":"SecureGuard PM",
				"label":"센터",
				"type":"security"
			},
			"192.168.0.200":{
				"ip":"192.168.0.200",
				"name":"Secu Watcher",
				"label":"센터",
				"type":"security"
			},
			"0.0.0.0": {
				"ip": "0.0.0.0",
				"name":"ISP",
				"label":"기타",
				"type":"cloud"
			},
			"0.0.0.1": {
				"ip": "0.0.0.1",
				"name":"POE",
				"label":"CCTV",
				"type":"workgroup switch"
			}			
		},
		icon: {
			
		},
		monitor: {
			"192.168.0.1": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.100.1": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.11": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.12": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.13": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.14": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.15": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.16": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.17": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.18": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.100": {
				protocol: "snmp",
				shutdown: false
			},
			"192.168.0.200": {
				protocol: "snmp",
				shutdown: false
			},
			"0.0.0.0": {
				protocol: "snmp",
				shutdown: false
			},
			"0.0.0.1": {
				protocol: "snmp",
				shutdown: false
			}
		},
		position: {
			"192.168.0.1": {
				x: 0,
				y: 0,
				ifEntry: {
					"192.168.100.1": ""
				}
			},
			"192.168.100.1": {
				x: -100,
				y: 0,
				ifEntry: {
					"192.168.0.1": ""
				}
			},
			"192.168.0.11": {
				x: 100,
				y: 0,
				ifEntry: {
				}
			},
			"192.168.0.12": {
				x: 200,
				y: 0,
				ifEntry: {
				}
			},
			"192.168.0.13": {
				x: 300,
				y: 0,
				ifEntry: {
				}
			},
			"192.168.0.14": {
				x: 400,
				y: 0,
				ifEntry: {
				}
			},
			"192.168.0.15": {
				x: 100,
				y: 100,
				ifEntry: {
				}
			},
			"192.168.0.16": {
				x: 200,
				y: 100,
				ifEntry: {
				}
			},
			"192.168.0.17": {
				x: 300,
				y: 100,
				ifEntry: {
				}
			},
			"192.168.0.18": {
				x: 400,
				y: 100,
				ifEntry: {
				}
			},
			"192.168.0.100": {
				x: 100,
				y: -100,
				ifEntry: {
				}
			},
			"192.168.0.200": {
				x: 200,
				y: -100,
				ifEntry: {
				}
			},
			"0.0.0.0": {
				x: -200,
				y: 0,
				ifEntry: {
				}
			},
			"0.0.0.1": {
				x: -400,
				y: 0,
				ifEntry: {
				}
			}
		},
		profile: {},
		critical: {},
		config: {
			dashboard: {
				"0": "responseTime",
				"1":"processor",
				"2":"memoryRate",
				"3":"throughputRate"
			}
		},
		account: {},
		icon: {}
	},
	topList = {
		"responseTime": {
			"192.168.0.1": {
				rate: -1,
				index: 0,
				value: 1
			}
		}
	},
	count = document.getElementById("count"),
	dialog = document.getElementById("dialog"),
	log = document.getElementById("log"),
	chart = {},
	sound = new Audio("siren.mp3"),
	logCount = 0;
	
function test() {
	let r = 100, n=12, dev, id=0;
	
	for (let j=0; j<2; j++, r+=50) {
		for (let i=0, th=0; i<n; i++, th=Math.PI*2*i/n, id++) {
			dev = {};
			
			dev.ip = "0.0.0." + (id +10);
			dev.name = "CCTV" + (id>9? id: "0"+ id);
			dev.label = "CCTV";
			dev.type = "cctv";
			
			window.databases.device[dev.ip] = dev;
			window.databases.position[dev.ip] = {
				x: Math.floor(r * Math.sin(th) /5) *5 -400,
				y: Math.floor(r * Math.cos(th) /5) *5,
				ifEntry: {"0.0.0.1": ""}
			}
			window.databases.position["0.0.0.1"].ifEntry[dev.ip] = "";
			window.databases.monitor[dev.ip] = {
				protocol: "snmp",
				shutdown: false
			};
		}
	}
}

test();

initialize();

		</script>
	
	</body>
	
</html>
