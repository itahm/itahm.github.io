<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>Critical @ ITAhM</title>
		
		<style>
@import "css/itahm.css";

body {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	padding: 0; margin: 0;
	display: flex;
	flex-direction: column;
}

ul {
	list-style: none;
	padding: 0; margin: 0;
}

.header {
	padding: .5em 0;
	border-bottom: 1px solid #aaa;
}

.header .item li {
	font-weight: bold;
	text-align: center;
}

.item ul {
	display: flex;
	cursor: pointer;
	padding: .5em;
	transition-duration: .3s;
}

#list .item ul:hover {
	border-radius: 0 0 .5em .5em;
	box-shadow: 0 .3em #999;
	padding: .2em .5em .5em .5em;
	margin-bottom: .3em;
}

.item .ip {
	width: 120px;
}

.item .resource {
	width: 150px;
	text-align: center;
}

.item .index {
	width: 80px;
	text-align: center;
}

.item .limit {
	width: 50px;
	text-align: center;
}

.item .description {
	flex: 1;
}

#list {
	flex: 1;
	overflow-y: auto;
}

		</style>
		
	</head>
	
	<body class="loading content_width">
		
		<div>
			<button id="add">임계 설정 추가</button>
		</div>
		
		<ul class="header">
			<li class="item">
				<ul>
					<li class="ip">IP
					<li class="resource">RESOURCE
					<li class="index">INDEX
					<li class="limit">LIMIT
					<li class="description">DESCRIPTION
				</ul>
		</ul>
		
		<ul id="list"></ul>
		
		<div class="bg_loading"></div>
		
		<script>
if (top === window) {
	location.href = "http://itahm.com";
}

var item = document.querySelector(".item"),
	resourceString = {
		"responseTime": "Rosponse time",
		"processor": "Processor load",
		"memory": "Physical memory",
		"storage": "Storage usage",
		"throughput": "Interface throughput"
	};

document.getElementById("add").onclick = function () {
	onSelectCritical();
};

(function () {
	var list = document.getElementById("list"),
		criticalData = top.databases.critical,
		df = document.createDocumentFragment(),
		critical, criticalResource, limit;
	
	for (var ip in criticalData) {
		critical = criticalData[ip];
		
		for (var resource in critical) {
			criticalResource = critical[resource];
			
			for (var index in criticalResource) {
				df.appendChild(createItem(ip, resource, index, criticalResource[index]));
			}
		}
	}
	
	list.appendChild(df);
}) ();

document.body.classList.remove("loading");

function onSelectCritical(ip, resource, index, limit) {
	top.showDialog("critical_dialog.html",
		function (dialog) {
			dialog.initialize(ip, resource, index, limit);
		},
		function () {
			location.reload();
		});
}

function createItem(ip, resource, index, critical) {
	var clone = window.item.cloneNode(true),
		item = clone.children[0];
	
	item.children[0].textContent = ip;
	item.children[1].textContent = resourceString[resource];
	item.children[2].textContent = index;
	item.children[3].textContent = critical.limit;
	item.children[4].textContent = critical.description;
	
	clone.onclick = onSelectCritical.bind(undefined, ip, resource, index, critical.limit);
	
	return clone;
}

		</script>
	
	</body>
	
</html>