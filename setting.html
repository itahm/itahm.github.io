<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>Setting @ ITAhM</title>
		
		<style>
@import "css/itahm.css";

body {
	padding: 10px;
	margin: 0 auto;
}

ul {
	list-style: none;
	padding: 0;
}

.item {
	display: flex;
	align-items: center;
}

.item span {
	margin-left: 10px;
	padding: .5em 1em;
	border: 1px solid transparent;
}

.item span:hover {
	cursor: pointer;
	text-decoration: underline;
	border-radius: 1em;
	background-color: #0084ff;
	color: #fff;
}

.layout {
	display: none;
}

img[src="img/plus.png"]:hover {
	cursor: pointer;
}

.list {
	max-height: 100px;
	overflow: auto;
	padding: 1em;
	border: 1px solid #ddd;
	background-color: #fdfdfd;
}

form input {
	padding: 3px;
}

input[name="clean"] {
	width: 50px;
	text-align: right;
}

.common li {
	margin: .5em 0;
}

		</style>
		<script>
		
function initAccount() {
	var list = document.getElementById("account_list"),
		accountData = top.databases.account,
		df = document.createDocumentFragment();
	
	for (var username in accountData) {
		df.appendChild(createItem(accountData[username].level === 0? "img/svg/root.svg": "img/svg/user.svg", username, onSelectAccount));
	}
	
	list.appendChild(df);
}
function initProfile() {
	var list = document.getElementById("profile_list"),
		profileData = top.databases.profile,
		df = document.createDocumentFragment();
	
	for (var name in profileData) {
		df.appendChild(createItem("img/svg/list.svg", name, onSelectProfile));
	}
	
	list.appendChild(df);
}

function initGCM() {
	var list = document.getElementById("gcm_list"),
		alarmData = top.databases.gcm,
		df = document.createDocumentFragment();
	
	for (var id in alarmData) {
		df.appendChild(createItem("img/svg/alarm.svg", id, onSelectGCM));
	}
	
	list.appendChild(df);
}

function onSelectAccount(username) {
	top.showDialog.call(window, "account_dialog.html", username);
}

function onSelectProfile(name) {
	top.showDialog.call(window, "profile_dialog.html", name);
}

function onSelectGCM(id) {
	top.showDialog.call(window, "gcm_dialog.html", id);
}

function createItem(src, key, func) {
	var clone = window.listItem.cloneNode(true);
	
	clone.children[0].src = src;
	clone.children[1].textContent = key;
	clone.children[1].onclick = func.bind(undefined, key);
	
	return clone;
}

function initConfig() {
	top.sendRequest({
		command: "pull",
		database: "config"
	}, function (response) {
		document.querySelector("input[name=clean]").value = response.clean;
		document.getElementById("java").textContent = response.java;
		document.getElementById("version").textContent = response.version;
		document.getElementById("space").textContent = ITAhM.util.toBytesString(response.space);
	});
}
		
		</script>
	</head>
	
	<body class="loading content_width">
		
		<div class="common">
			<h2>일반</h2>
				<ul>
					<li>자바 버전 : <span id="java"></span>
					<li>에이전트 버전 : <span id="version"></span>
					<li>에이전트 저장공간 여유 : <span id="space"></span>
					<li>
						<form id=clean>
							데이터 보관 기간 : <input type="number" min="0" max="365" name="clean"> 일 <input type="submit" value="적용">
							<i>(데이터 정리 기능을 사용하지 않는 경우 0)</i>
						</form>
				</ul>
		</div>
		
		<div>
			<h2>계정 <img width="16" height="16" src="img/plus.png" title="계정 추가" id="add_account"></h2>
			<ul id="account_list" class="list"></ul>
		</div>
		
		<div>
			<h2>프로파일 <img width="16" height="16" src="img/plus.png" title="프로파일 추가" id="add_profile"></h2>
			<ul id="profile_list" class="list"></ul>
			<i>등록된 Profile은 변경할 수 없습니다. 삭제후 추가하십시오. (사용중인 Profile은 삭제할 수 없습니다.)</i>
		</div>
		
		<div>
			<h2>이벤트 알림 <img width="16" height="16" src="img/plus.png" title="알림 추가" id="add_gcm"></h2>
			<ul id="gcm_list" class="list"></ul>
		</div>
			
		<div class="bg_loading"></div>
		
		<div class="layout">
			<ul>
				<li class="item">
					<img width="16" height="16">
					<span></span>
			</ul>
		</div>
		
		<script src="js/ITAhM.js"></script>
		<script>
if (top === window) {
	location.href = "http://itahm.com";
}

var listItem = document.querySelector(".item");

document.getElementById("add_account").onclick = function () {
	onSelectAccount();
};

document.getElementById("add_profile").onclick = function () {
	onSelectProfile();
};

document.getElementById("add_gcm").onclick = function () {
	onSelectGCM();
};

document.getElementById("clean").onsubmit = function (e) {
	e.preventDefault();
	
	document.body.classList.add("loading");
	
	top.sendRequest({
		command: "config",
		key: "clean",
		value: parseInt(this.elements["clean"].value)
	}, function (response) {
		document.body.classList.remove("loading");
		
		alert("데이터 보관 기간을 설정하였습니다.");
	});
	
};

initConfig();

initAccount();

initProfile();

initGCM();

document.body.classList.remove("loading");

		</script>
	
	</body>
	
</html>