<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>ITAhM</title>
		
		<style>

@import url("css/itahm.css");
@import url("css/chart.css");

#chart {
	flex: 1;
}

nav {
	padding: 1em;
	float: right;
}

nav img {
	cursor: pointer;
}

		</style>
		
	</head>
	
	<body>
		
		<header>
			<nav>
				<img width="16" height="16" src="img/realtime.png" id="realtime" title="실시간 차트">
				<img width="16" height="16" src="img/save.png" id="save" title="CSV 파일로 저장">
				<a href="status.html"><img width="16" height="16" src="img/close.png" title="차트 닫기"></a>
			</nav>
			<h1><span id="resource"></span> @ <span id="host"></span></h1>
		</header>
		
		<iframe id="chart" class="chart"></iframe>
		
		<iframe id="cursor"></iframe>
		
		<script src="js/ITAhM.js"></script>
		<script>

if (parent === window) throw "";		

var chart = document.getElementById("chart"),
	chartWindow = chart.contentWindow,
	cursor = document.getElementById("cursor"),
	deviceIP = top.databases.local.selected,
	resourceIndex = top.databases.local.resourceIndex,
	node = top.databases.local.node;

document.getElementById("save").onclick = function () {
	chartWindow.getFile();
};

document.getElementById("realtime").onclick = function () {
	open("realtime.html", "_blank", "width=600, height=300, resizable=yes", false);
};

(function (date) {
	date.setHours(0, 0, 0, 0);
	
	window.today = date.getTime();
	window.end = date.setDate(date.getDate() +1);
	window.start = date.setMonth(date.getMonth() -1);
})(new Date());

window.chart.onload = function () {
	window.cursor.src = "date_cursor.html";
	
	window.chartWindow.initialize(window.start, window.end, window.today, window.end);
};	

window.cursor.onload = function () {
	var cursorWindow = window.cursor.contentWindow;
	
	cursorWindow.onResetDate = window.chartWindow.draw;
	cursorWindow.initialize(window.start, window.end, window.end, window.today);
};

(function () {
	document.getElementById("host").textContent = window.deviceIP;
	
	switch(top.databases.local.selectedResource) {
	case "responseTime":
		document.getElementById("resource").textContent = "Response time";
		
		break;
	case "processor":
		document.getElementById("resource").textContent = "Processor load";
		
		break;
	case "storage":
		document.getElementById("resource").textContent = "Storage usage";
		
		break;
	case "memory":
		document.getElementById("resource").textContent = "Physical memory";
		
		break;
	case "throughput":
		document.getElementById("resource").textContent = "Interface throughput";
		
		break;
	case "error":
		document.getElementById("resource").textContent = "Interface error";
		
		break;
	}
	
	window.chart.src = "chart_"+ top.databases.local.selectedResource +".html";
}) ();

/**
 * public
 */
function onSelectDevice(ip) {
	if (top.databases.monitor[ip]) {
		top.databases.local.selected = ip;
	
		top.sendRequest({
			command: "select",
			ip: ip
		}, function (response) {
			top.databases.local.node = response;
		
			location.reload();
		});
	}
	else {
		alert("SNMP is not enabled for "+ ip);
	}
}

		</script>
	
	</body>
	
</html>