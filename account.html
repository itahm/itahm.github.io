<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>Account @ ITAhM</title>
		
		<style>
@import "css/itahm.css";

body {
	padding: 20px;
}

body {
	padding: 20px;
}

header {
	text-align: right;
}

#list {
	list-style: none;
	padding: 3px;
	margin: 0;
}

.icon {
	display: flex;
	align-items: center;
	padding: 10px;
	border: 1px solid transparent;
}

.icon:hover {
	text-decoration: underline;
	cursor: pointer;
	border-color: #0084ff;
	border-radius: 5px;
	background-color: #fafaff;
}

.icon span {
	font-size: 32px;
	margin-left: 1em;
}

.layout {
	display: none;
}

		</style>
		
	</head>
	
	<body class="loading content_width">
		
		<header>
			<button id="sync" class="r_button" style="display: none;">Sync</button>
		</header>
		
		<ul id="list"></ul>
		
		<div class="bg_loading"></div>
		
		<div class="layout">
			<ul>
				<li class="icon">
					<img width="64" height="64">
					<span></span>
			</ul>
		</div>
		
		<script>
if (top === window) {
	location.href = "http://itahm.com";
}

(function (window, undefined) {
	
	var list = document.getElementById("list"),
		icon = document.querySelector(".icon");
	
	document.getElementById("sync").onclick = onSync;
	
	initialize();
	
	function onSync() {
		if (!confirm("Synchronize account database with agent now?")) {
			return;
		}
		
		top.sendRequest({
			command: "push",
			database: "account",
			sequence: top.databases.account.sequence,
			data: top.databases.account.data
		}, function (response) {
			if (response) {
				top.databases.account.sequence = response.sequence;
			}
			else {
				alert("synchronization failed.");
			}
		});
	}
	
	function onSelectAccount(username) {
		top.showDialog("account_dialog.html",
			function (dialog) {
				dialog.initialize(username);
			},
			function () {
				location.reload();
			});
	}
	
	function createIcon(src, label) {
		var clone = icon.cloneNode(true);
		
		clone.children[0].src = src;
		clone.children[1].textContent = label;
		
		return clone;
	}
	
	function initialize() {
		var accountData = top.databases.account.data,
			df = document.createDocumentFragment(),
			span;
		
		for (var username in accountData) {
			df.appendChild(createIcon("img/svg/user.svg", username)).onclick = onSelectAccount.bind(undefined, username);
		}
		
		list.appendChild(df);
		
		document.body.classList.remove("loading");
	};
	
}) (window);
		</script>
	
	</body>
	
</html>