<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title></title>
		
		<style>
@import "css/itahm.css";

body {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	margin: 0; padding: 0;
}

iframe {
	border: none;
	width: 100%; height: 100%;
}

nav {
	position: absolute; top: 5px;
}

nav.right {
	right: 5px;
}

nav.left {
	left: 5px;
}

nav input,
nav img {
	vertical-align: middle;
}

nav img {
	cursor: pointer;
}

nav {
	font-size: 9pt;
}

body:not(.root) .root {
	display: none;
}

		</style>
		
		<script>

function resize() {
	window.mapWindow.resize();
}

function editDevice(ip) {
	top.showDialog.call(window, "device_dialog.html", ip);
}

function onEdit() {
	editDevice();
}

function onSave() {
	var request = {
			command: "push",
			database: "position",
			data: window.top.databases.position
		};
	
	top.sendRequest(request, function (response) {
		alert("구성의 변경사항을 저장하였습니다.");
	});
}

function onEvent(ip) {
	if (top.databases.device[ip]) {
		window.mapWindow.resetDevice(ip, true);
	}
}		

function onSetAlarm(ip){
	top.showDialog.call(undefined, "critical_dialog.html", ip);
}

		</script>
		
		
	</head>
	
	<body class="loading">
		
		<iframe id="map" src="map_base.html"></iframe>
		
		<nav class="left">
			<img src="img/add_device.png" width="16px" height="16px" title="장비 추가" id="add" class="root">
			<img src="img/save.png" width="16px" height="16px" title="저장" id="save"  class="root">
			<img src="img/zoomin.png" width="16px" height="16px" title="확대" id="zoom_in">
			<img src="img/zoomout.png" width="16px" height="16px" title="축소" id="zoom_out">
		</nav>
		
		<nav class="right">	
			<label title="인터페이스명 표시/감추기"><input type="checkbox" id="ifname" checked>interface</label>
				<label title="장비명 표시"><input type="radio" name="display" id="name" value="false" checked>name</label>
			<label title="IP 표시"><input type="radio" name="display" id="address" value="true">ip address</label>
		</nav>
				
		<div class="bg_loading"></div>
		<script>

if (sessionStorage.level == 0) {
	document.body.classList.add("root");
}

var map = document.getElementById("map");

document.getElementById("save").onclick = onSave;

document.getElementById("add").onclick = onEdit;

window.map.onload = function () {
	var mapWindow = window.map.contentWindow,
		scale, ip;
	
	window.mapWindow = mapWindow;
	
	window.addEventListener("resize", function () {
		clearTimeout(window.schedule);
		
		window.schedule = setTimeout(resize, 500);
	});
	
	document.getElementById("zoom_in").onclick = function () {
		mapWindow.zoom(scale *= 1.1);
		
		window.top.databases.local.scale = scale;
	}

	document.getElementById("zoom_out").onclick = function () {
		mapWindow.zoom(scale /= 1.1);
		
		window.top.databases.local.scale = scale;
	}

	document.getElementById("name").onchange = function () {
		mapWindow.displayIPAddress(false);
	};

	document.getElementById("address").onchange = function () {
		mapWindow.displayIPAddress(true);
	};

	document.getElementById("ifname").onchange = function () {
		mapWindow.displayIFName(this.checked);
	};
	
	mapWindow.addEventListener("wheel", function (e) {
		mapWindow.zoom(e.deltaY < 0? scale *= 1.1: scale /= 1.1);
		
		window.top.databases.local.scale = scale;
	});
	
	mapWindow.onEditDevice = editDevice;
	
	mapWindow.onShowChart = function (ip){
		window.top.databases.local.selected = ip;
		
		window.location.href = "status.html";
	}
	
	mapWindow.onShowAlarm = onSetAlarm;
	
	mapWindow.zoom(scale = window.top.databases.local.scale);
	
	mapWindow.initialize();
	
	if (ip = top.databases.local.selected) {
		var pos = window.top.databases.position[ip];
		
		top.databases.local.selected = undefined;
		
		mapWindow.moveAllDevice(- pos.x, - pos.y);
		mapWindow.selectDevice(ip);
	}
	
	document.body.classList.remove("loading");
}

		</script>
	
	</body>
	
</html>