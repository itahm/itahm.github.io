<!DOCTYPE html>
<html>

	<head>
		<title>ITAhM</title>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<link rel="shortcut icon" href="favicon.ico">
		
		<style>
		#chart {
			position: fixed; top: 20px; right: 20px; bottom: 20px; left: 20px;
			display: -webkit-flex;
			display: flex;
			flex-direction: column;
		}
		
		#chart> .chart {
			-webkit-flex: 1;
			flex: 1;
			height: 0;
			position: relative;
		}
		
		h4,
		li,
		input,
		span,
		label {
			font-family: tahoma, arial, "맑은 고딕"
		}
		
		li {
			font-size: 15px;
		}
		
		input,
		label {
			font-size: 13px;
		}
		canvas {
			display: block;
			background-color: #f8f8f8;
			border-radius: 10px;
		}
		
		img {
			vertical-align: middle;
		}
		
		a {
			font-weight: bold;
		}
		
		a:link,
		a:visited,
		a:active {
			color: #000;
			text-decoration: none;
		}
		
		a:hover {
			color: #73a4e6;
			text-decoration: none;
			cursor: pointer;
		}
		
		#controller {
			position: absolute; top: 5px; right: 10px; left: 0;
		}
		
		#controller > div.right {
			float: right;
		}
		
		#controller > div.left {
			float: left;
		}
		
		#controller #offline,
		#controller.realtime #realtime,
		#controller.realtime #detail,
		#controller.realtime .date {
			display: none;
		}
		
		#controller.realtime #offline {
			display: inline;
		}
		
		img.button {
			border: 1px solid transparent;
		}
		
		img.button:hover {
			border-color: #08f;
			cursor: pointer;
		}
		
		</style>
		<script src="ITAhM.js"></script>
		<script src="Draggable.js"></script>
		<script src="Manager.js"></script>		
		<script src="createData.js"></script>
		<script src="Chart.js"></script>
	</head>

	<body>
		<div id="chart">
			<h4>itahm이 chart를 보여주는 방법</h4>
			<ul>
				<li>1년간의 data를 chart에 표현할수 있으며
				1시간 간격으로 summary한 최대값과 최소값을 영역으로 그리고 평균값을 영역내 꺾은 선으로 그립니다.
				<li>아래 chart는 1년동안의 cpu load data를 simulation한 것입니다.
				<li>좌측 y축은 원본값 (load 이므로 0 ~ 100) 이고, 우측 y축은 항상 최대값 대비 백분률입니다.
				<li>마우스를 chart위에서 scroll 하세요. 중앙을 기준으로 표시하는 기간을 확대하거나 축소합니다.
				<li>마우스를 chart위에서 drag 하세요. 표시하는 기간을 전 후로 이동 시킵니다.
				<li>chart는 최대값과 최소값을 벗어난 영역은 그리지 않습니다.
				<li>우측 상단 "csv" "png" 버튼을 누르면 해당하는 파일을 다운로드 할 수 있습니다. (일부 브라우저 미지원)
				<li>좌측 상단 기간 입력을 통해 시작과 끝 날짜를 지정할 수 있습니다.
				시작(from)은 입력 날짜의 0시를, 끝(to)은 입력 날짜의 24시(다음날 0시)로 설정됩니다. (시 분 초 단위 제어 불가)
				달력을 지원하지 않는 브라우저 에서는 yyyy-mm-dd 의 형식으로 날짜를 직접 입력해야 합니다.
				<li>좌측 상단 돋보기 버튼(<img src="img/detail.png" height="16px" width="16px">)을 누르면 1시간 summary가 아닌 1분단위 실 data를 추가적으로 보여줍니다.
				<li>또한 chart와 실시간 그래프를 오가며 보여줄 수 있는 기능을 버튼(<img src="img/realtime.png" height="16px" width="16px">)을 통해 제공합니다.
			</ul>
		</div>
		<div id="controller">
			<div class="right">
				<img src="img/download.png" width="16px" height="16px">
				<a id="down_csv" title="download chart data as chart.csv">csv</a>
				<a id="down_png" title="download chart image as chart.png">png</a>
			</div>
			<div class="left">
				<img src="img/chart.png" id="offline" width="16px" height="16px" title="offline chart" class="button">
				<img src="img/realtime.png" id="realtime" width="16px" height="16px" title="realtime chart" class="button">
				<img src="img/detail.png" id="detail" width="16px" height="16px" title="detailed chart" class="button">
				<img src="img/calendar.png" width="16px" height="16px">
				<div class="date">
					<label>
						from
						<input type="date" id="start">
					</label>
					<label>
						to
						<input type="date" id="end">
						<input type="button" value="apply" id="reset">
					</label>
				</div>
			</div>
		</div>
		
		<script>
		
var 
	container = document.querySelector("#chart"),
	chart = new Chart(container, {
		id: 1,
		title: "processor load (%)",
		onxvalue: function (value) {
			return value && value.toFixed(2);
		},
		onyvalue: function (value) {
			return value && value.toFixed(2);
		},
		bgcolor: "#fff"
	}),
	manager = Manager.getInstance(chart),
	manager2 = Manager.getInstance(chart, "RealTimeManager"),
	elements = {
		controller: document.getElementById("controller"),
		reset: document.getElementById("reset"),
		downPng: document.getElementById("down_png"),
		downCsv: document.getElementById("down_csv"),
		start: document.getElementById("start"),
		end: document.getElementById("end"),
		detail: document.getElementById("detail"),
		offline: document.getElementById("offline"),
		realtime: document.getElementById("realtime")
	},
	FILE_PNG_NAME = "chart.png",
	timer;

manager.data = createData();

manager.onchange = function (start, end) {
	elements.start.value = new Date(start).toISOString().slice(0,10);
	elements.end.value = new Date(end).toISOString().slice(0,10);
};

chart.appendChild(elements.controller);
chart.connect(manager);

elements.controller.addEventListener("mousedown", function (e) {
	e.stopPropagation();
}, false);

elements.downPng.addEventListener("click", function (e) {
	chart.download();
}, false);

elements.downCsv.addEventListener("click", function (e) {
	manager.download();
}, false);

elements.detail.addEventListener("click", function (e) {
	manager.showDetail();
}, false);

elements.offline.addEventListener("click", function (e) {
	elements.controller.classList.remove("realtime");
	
	clearInterval(timer);
	
	manager2.clear();
	
	chart.connect(manager);
}, false);

elements.realtime.addEventListener("click", function (e) {
	elements.controller.classList.add("realtime");
	
	chart.connect(manager2);
	
	timer = setInterval(function () {
		manager2.update(new Date().getTime(), Math.random() *100);
	}, 1000);
}, false);

elements.reset.addEventListener("mousedown", function (e) {
	e.stopPropagation();
}, false);

elements.reset.addEventListener("click", function (e) {
	var start = Date.parse(elements.start.value),
		end = Date.parse(elements.end.value);
	
	if (isNaN(start) || isNaN(end)) {
		return;
	}
	
	end = new Date(end);
	end.setHours(0);
	
	manager.setDate(new Date(start).setHours(0), end.setDate(end.getDate() +1));
}, false);		
		
		</script>
	</body>
</html>

