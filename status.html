<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Status @ ITAhM</title>

		<style>
@import "css/itahm.css";

body,
section {
	margin: 0;
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
}

nav {
	position: absolute; top: 1em; right: 1em;
	/*padding: .5em;
	border-radius: 50%;
	background-color: #0084ff;*/
}

section {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
}

iframe {
	border: none;
	width: 100%; height: 100%;
}

h1 {
	font-size: 20px;
}

nav img {
	cursor: pointer;
}

body:not(.shutdown) section {
	display: none;
}

body.shutdown nav {
	display: none;
}

		</style>
		
		<script>
		
function onSelectResource(resource, index) {
	top.databases.local.selectedResource = resource;
	top.databases.local.resourceIndex = index;
	
	location.href = "chart.html";
}

		</script>
		
	</head>

	<body class="loading">
		<iframe id="status"></iframe>
		
		<nav>
			<img id="print" src="img/printer.png" width="24" height="24" title="인쇄">
			<img id="refresh" src="img/refresh.png" width="24" height="24" title="새로고침">
		</nav>
		
		<section>
			<h1 id="host"></h1>
			<p>에이전트가 실행된 이후로 응답이 없는 장비입니다.</p>
			<p>성능 정보를 불러올 수 없습니다.</p>
		</section>
		
		<div class="bg_loading"></div>
	</body>
	
	<script>

var deviceIP = window.top.databases.local.selected,
	frame = document.getElementById("status");

if (!deviceIP) {
	throw "!";
}

window.device = top.databases.device[deviceIP];

document.getElementById("host").textContent = deviceIP;

document.getElementById("refresh").onclick = function () {
	window.location.reload();	
};

document.getElementById("print").onclick = function () {
	window.statusWindow.print();	
};

top.sendRequest({
	command: "select",
	ip: window.device.ip
}, function (snmp) {
	if (!snmp.lastResponse) {
		document.body.classList.add("shutdown");
	}
	else {
		top.databases.local.node = snmp;
		
		frame.src = "status_base.html";		
	}
	
	document.body.classList.remove("loading");
});

frame.onload = function () {
	window.statusWindow = this.contentWindow;
	
	window.statusWindow.onSelectResource = onSelectResource;
	window.statusWindow.initialize(window.device.ip);
};
	</script>
</html>